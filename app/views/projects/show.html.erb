<%=render partial: "projects/show_partials/project_always_present"%>


  <hr class="my-4">
  <p>latitude: <%= @project.latitude %> </p>
  <p>longitude: <%= @project.longitude %> </p>
  <p>Poster: <%= @project.user.first_name %> </p>

<%if signed_in?%>
  <%if current_user.id == @project.user_id || current_user.moderator? || current_user.superadmin?%>
    <%if @project.is_complete == false%>
      <%= link_to 'Mark as Complete', complete_project_path(@project.id), method: :patch%>
      <%= link_to 'Edit', edit_project_path(@project) %>
      <%= link_to 'Delete', project_path(@project),
                        method: :delete,
                        data: {confirm: 'Sure?'}%>
      <h1> Pending Volunteers: </h1>
      <%= render partial: 'users/volunteer', collection: @pending, as: :response%>
    <%end%>
    <h1> Approved Volunteers: </h1>
    <%= render partial: 'users/volunteer', collection: @approved, as: :response%>
  <%else%>
    <%if @responses.find_by(user_id: current_user.id).nil? && @project.is_complete == false%>
      <%=link_to "Volunteer!", "#", "data-target": "#confirm-volunteering-modal", "data-toggle": "modal", class: 'btn btn-primary' %>
    <%end%>
  <%end%>
<% end %>
<%= link_to 'Chat', rooms_show_path %>

<!-- Modal for review form -->
<%@approved.each_with_index do |r|%>
  <div class="modal fade" id="ratingmodal-<%=r.user.id%>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Rate <%=r.user.full_name%></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <%= render :partial => 'reviews/form', locals: {user_id: r.user.id} %>      
        </div>
      </div>
    </div>
  </div>
<% end %>


<!-- Modal for volunteer confirmation -->
<div class="modal fade" tabindex="-1" role="dialog" id="confirm-volunteering-modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <%= form_with url: responses_path do |form|%>
          <%= form.hidden_field :project_id, value: @project.id %>
          <%= form.submit "I want to volunteer", class: "btn btn-success w-100"%>
        <% end %>
      </div>
    </div>
  </div>
</div>